<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Cadeau mystique à gratter</title>

  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #0b0b12;
      font-family: system-ui, sans-serif;
      overscroll-behavior: none;
      touch-action: none;
    }

    .wrap {
      height: 100%;
      display: grid;
      place-items: center;
      padding: 14px;
      box-sizing: border-box;
    }

    .card {
      width: min(92vw, 420px);
      aspect-ratio: 1 / 1;
      position: relative;
      overflow: hidden;
      border-radius: 18px;
      background: #111;
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
    }

    .reveal {
      position: absolute;
      inset: 0;
      background: url("reveal.png") center / cover no-repeat;
    }

    canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .hint {
      position: absolute;
      bottom: 12px;
      left: 12px;
      right: 12px;
      padding: 10px;
      border-radius: 14px;
      background: rgba(0,0,0,.4);
      color: #fff;
      text-align: center;
      font-size: 14px;
      pointer-events: none;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" id="card">
      <div class="reveal"></div>
      <canvas id="scratch"></canvas>
      <div class="hint" id="hint">Gratte avec ton doigt ✨</div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("scratch");
    const ctx = canvas.getContext("2d");
    const card = document.getElementById("card");
    const hint = document.getElementById("hint");

    const wrapImg = new Image();
    wrapImg.src = "wrap.png";

    const BRUSH_RADIUS = 28;
    let scratching = false;

    function resize() {
      const r = card.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;

      canvas.width  = r.width  * dpr;
      canvas.height = r.height * dpr;
      canvas.style.width  = r.width  + "px";
      canvas.style.height = r.height + "px";

      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      drawWrap();
    }

    function drawWrap() {
      if (!wrapImg.complete) return;

      const w = canvas.width / (window.devicePixelRatio || 1);
      const h = canvas.height / (window.devicePixelRatio || 1);

      ctx.globalCompositeOperation = "source-over";
      ctx.clearRect(0, 0, w, h);

      const scale = Math.max(w / wrapImg.width, h / wrapImg.height);
      const dw = wrapImg.width * scale;
      const dh = wrapImg.height * scale;

      ctx.drawImage(
        wrapImg,
        (w - dw) / 2,
        (h - dh) / 2,
        dw,
        dh
      );
    }

    function getPos(e) {
      const r = canvas.getBoundingClientRect();
      const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left;
      const y = (e.touches ? e.touches[0].clientY : e.clientY) - r.top;
      return { x, y };
    }

    function scratch(e) {
      const { x, y } = getPos(e);
      ctx.globalCompositeOperation = "destination-out";
      ctx.beginPath();
      ctx.arc(x, y, BRUSH_RADIUS, 0, Math.PI * 2);
      ctx.fill();
      hint.style.opacity = 0;
    }

    canvas.addEventListener("touchstart", e => { scratching = true; scratch(e); }, { passive:false });
    canvas.addEventListener("touchmove",  e => { if (scratching) scratch(e); }, { passive:false });
    canvas.addEventListener("touchend",   () => scratching = false);

    canvas.addEventListener("mousedown", e => { scratching = true; scratch(e); });
    window.addEventListener("mousemove", e => { if (scratching) scratch(e); });
    window.addEventListener("mouseup",   () => scratching = false);

    wrapImg.onload = resize;
    window.addEventListener("resize", resize);
  </script>
</body>
</html>


